function ChefboxZeigen(){window.open("./chefbox.php","chefbox","height=800,width=450,scrollbars=yes,resizable=yes").focus();return!1}function BLMEnde(){opener?(opener.focus(),self.close()):document.location.href="actions/logout.php?popup=1";return!1}function BLMNavigation(a){opener?(opener.document.location.href=a,opener.focus()):(opener=a=window.open(a),a.focus());return!1}function ZeichenUebrig(a,b){b.innerText=4096-a.value.length;return!0}
function RechneProduktionsKosten(a,b,c,d,e,f){a=b/a*c;e.innerText="Kosten: "+a.toLocaleString(navigator.language,{minimumFractionDigits:2,maximumFractionDigits:2})+" \u20ac";a>d||0>=a||isNaN(a)?(f.enabled="",f.disabled="disabled"):(f.disabled="",f.enabled="enabled")}function CheckKrieg(a){2===a.selectedIndex?document.getElementById("kriegBetrag").style.display="block":document.getElementById("kriegBetrag").style.display="none"}
function confirmAbort(a,b){return confirm("Wollen Sie den Auftrag wirklich abbrechen? Sie bekommen nur "+b+" (entspricht "+a+") der Kosten zur\u00fcckerstattet!")}
function CountdownFields(){let a=(b,c)=>{if(b.innerText.includes("Tage")){var d=b.innerText.split(" Tage ")[0];var e=b.innerText.split(" Tage ")[1];d=Date.parse("1970-01-01T"+e+"Z")+864E5*d}else d=Date.parse("1970-01-01T"+b.innerText+"Z");if(0<d||0<c)b.innerText="",e=new Date(d+1E3*c),864E5<d&&0>c&&(b.innerText+=Math.floor(d/864E5)+" Tage"),b.innerText+=" "+e.toLocaleTimeString("de-DE",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"UTC"}),"00:00:00"===b.innerText&&reloadOnCountdown&&
(document.location.href.includes("?")?document.location.href+="&rld=1":document.location.href+="?rld=1")};Array.prototype.forEach.call(document.getElementsByClassName("countdown"),b=>a(b,-1));Array.prototype.forEach.call(document.getElementsByClassName("countup"),b=>a(b,1))}
function MafiaActionChange(){var a=Number.parseInt(document.getElementById("mafia_action").value);a=mafia_cost_data[a];a=[a.costs[0]+" \u20ac / "+100*a.chance[0]+"%",a.costs[1]+" \u20ac / "+100*a.chance[1]+"%",a.costs[2]+" \u20ac / "+100*a.chance[2]+"%",a.costs[3]+" \u20ac / "+100*a.chance[3]+"%"];let b=document.getElementById("level").getElementsByTagName("option");for(let c=0;c<b.length;c++)b[c].innerText=a[c]}
function ChangeBankDepositWithdraw(){var a=document.form_bank;const b=a.art.value;a=a.betrag;var c=a.getAttribute("data-bank");const d=a.getAttribute("data-geld"),e=Math.min(d,a.getAttribute("data-deposit-limit")-c).toFixed(2);c=Math.max(0,c).toFixed(2);const f=Number.parseFloat(a.value).toFixed(2);if("0.00"===f||f===e||f===c||f===d.toFixed(2))switch(b){case "1":a.value=e;break;case "2":a.value=c;break;case "3":a.value=d}}
function enableSitterOptions(a){Array.prototype.forEach.call(document.getElementById("sitterSettings").getElementsByTagName("input"),b=>{"sitting_aktiviert"!==b.id&&"submit"!==b.type&&"hidden"!==b.type&&(b.disabled=!a)})}function enableImportOptions(a){document.getElementById("verify").disabled=a;document.getElementById("ignore_round").disabled=a}
function chefboxPollJobs(){opener&&window.setInterval(()=>{var a=opener.document.getElementsByClassName("MessageBox");0!==a.length&&(a=a[0],a.hasAttribute("reload-chefbox")&&(a.removeAttribute("reload-chefbox"),window.location.reload()))},1E3)}
function deobfuscate(){let a=document.getElementsByClassName("bot");for(let c=0;c<a.length;c++){let d=a.item(c);var b=void 0;let e="";-1!==d.textContent.indexOf("@")?(b=d.textContent.substring(0,d.textContent.indexOf("@")),e=d.textContent.substring(d.textContent.indexOf("@"))):b=d.textContent;b=b.match(/.{1,2}/g).map(f=>String.fromCharCode(parseInt(f,16))).join("");d.textContent=b+e}}let reloadOnCountdown=!1;deobfuscate();window.setInterval(CountdownFields,1E3);
function confirmGruppeDiplomatie(){let a=document.getElementById("relation_typ");null!==a&&(a.onchange=()=>CheckKrieg(a),CheckKrieg(a));for(let b of document.getElementsByClassName("cancel_relation")){let c=b.getAttribute("data-type"),d=b.getAttribute("data-partner");b.onclick=()=>confirm("Wollen Sie die "+c+' Beziehung mit "'+d+'" wirklich k\u00fcndigen?')}for(let b of document.getElementsByClassName("retract_relation_offer")){let c=b.getAttribute("data-type"),d=b.getAttribute("data-partner");b.onclick=
()=>confirm("Wollen Sie die "+c+' Anfrage mit "'+d+'" wirklich zur\u00fcckziehen?')}for(let b of document.getElementsByClassName("war_surrender")){let c=b.getAttribute("data-name"),d=b.getAttribute("data-amount"),e=b.getAttribute("data-points"),f=b.getAttribute("data-plantage");b.onclick=()=>confirm("Wollen Sie in dem Krieg mit "+c+" wirklich kapitulieren? Der umk\u00e4mpfte Betrag ("+d+") geht an den Gegner, jeder Ihrer Gruppenmitglieder verliert "+e+" seiner Punkte und "+f+" Stufe(n) seiner Plantagen!")}}
confirmGruppeDiplomatie();
function confirmMarktplatzListe(){for(let a of document.getElementsByClassName("market_buy_offer")){let b=a.getAttribute("data-id");a.onclick=()=>confirm("Wollen Sie das Angebot Nr "+b+" wirklich kaufen?")}for(let a of document.getElementsByClassName("market_retract_offer")){let b=a.getAttribute("data-id"),c=a.getAttribute("data-refund");a.onclick=()=>confirm("Wollen Sie das Angebot Nr "+b+" wirklich zur\u00fcckziehen?\nSie erhalten lediglich "+c+" kg der Waren zur\u00fcck.")}}confirmMarktplatzListe();
function confirmAdminBenutzer(){for(let a of document.getElementsByClassName("delete_user"))a.onclick=()=>confirm('Benutzer "'+a.getAttribute("data-username")+'"wirklich l\u00f6schen?')}confirmAdminBenutzer();function confirmAdminGruppe(){for(let a of document.getElementsByClassName("delete_group"))a.onclick=()=>confirm('Gruppe "'+a.getAttribute("data-groupname")+'"wirklich l\u00f6schen?')}confirmAdminGruppe();
function confirmJobAbort(){for(let a of document.getElementsByClassName("delete_job"))a.onclick=()=>confirmAbort(a.getAttribute("data-refund"),a.getAttribute("data-percent"))}confirmJobAbort();function confirmGruppeMitglieder(){for(let a of document.getElementsByClassName("kick_member")){let b=a.getAttribute("data-username");a.onclick=()=>confirm('Wollen Sie das Mitglied "'+b+'" wirklich aus der Gruppe entfernen?')}}confirmGruppeMitglieder();
function confirmVertraegeListe(){for(let a of document.getElementsByClassName("accept_contract")){let b=a.getAttribute("data-id");a.onclick=()=>confirm("Wollen Sie den Vertrag Nr "+b+" wirklich annehmen?")}for(let a of document.getElementsByClassName("reject_contract")){let b=a.getAttribute("data-id");a.onclick=()=>confirm("Wollen Sie den Vertrag Nr "+b+" wirklich ablehnen?")}}confirmVertraegeListe();
function setupMafiaAction(){let a=document.getElementById("mafia_action");null!==a&&(a.oninput=()=>MafiaActionChange(),MafiaActionChange())}setupMafiaAction();function setupLinks(){var a=document.getElementById("link_chefbox");null!==a&&(a.onclick=()=>ChefboxZeigen());if(null!==document.getElementById("link_logout")){a=document.getElementById("Navigation").getElementsByTagName("a");for(let b of a)b.classList.contains("inactive")&&(b.href+="#Inhalt")}}setupLinks();
function setupBank(){null!==document.getElementById("form_bank")&&(document.getElementById("einzahlen").onchange=()=>ChangeBankDepositWithdraw(),document.getElementById("auszahlen").onchange=()=>ChangeBankDepositWithdraw(),null!==document.getElementById("gruppen_kasse")&&(document.getElementById("gruppen_kasse").onchange=()=>ChangeBankDepositWithdraw()),ChangeBankDepositWithdraw())}setupBank();
function setupLeaveGroup(){let a=document.getElementById("leave_group");null!==a&&(a.onclick=()=>confirm("Wollen Sie wirklich aus der Gruppe austreten?"))}setupLeaveGroup();
function setupPlantage(){let a=document.getElementById("fast_plant"),b=document.getElementById("stunden");b.onchange=()=>RechneProduktionsKosten(1,a.getAttribute("data-cost-per-hour"),b.value,a.getAttribute("data-geld"),document.getElementById("pr_ko_all"),document.getElementById("plant_all"));b.onkeyup=b.onchange;for(let c of document.getElementsByClassName("amount_field")){let d=c.getAttribute("data-id");c.onchange=()=>RechneProduktionsKosten(c.getAttribute("data-menge"),c.getAttribute("data-kosten"),
c.value,a.getAttribute("data-geld"),document.getElementById("pr_ko_"+d),document.getElementById("plant_"+d));c.onkeyup=c.onchange}for(let c of document.getElementsByClassName("delete_plant_job"))c.onclick=()=>confirm("Wollen Sie den Auftrag wirklich abbrechen? Sie bekommen die Kosten nicht zur\u00fcck erstattet, lediglich die bisher produzierte Menge (~ "+c.getAttribute("data-refund")+") wird Ihnen gut geschrieben.")}null!==document.getElementById("fast_plant")&&setupPlantage();
let closeMessageBox=document.getElementById("close_message");null!==closeMessageBox&&(closeMessageBox.onclick=()=>closeMessageBox.parentElement.remove());function setupAdminBenutzerImportieren(){if(null!==document.getElementById("gdpr_import")){let a=document.getElementById("ignore_metadata");a.addEventListener("change",b=>enableImportOptions(b.currentTarget.checked));enableImportOptions(a.checked)}}setupAdminBenutzerImportieren();
function setupEinstellungen(){let a=document.getElementById("sitting_aktiviert");null!==a&&(a.addEventListener("change",b=>enableSitterOptions(b.currentTarget.checked)),enableSitterOptions(a.checked))}setupEinstellungen();function setupCharsLeft(a){let b=document.getElementById(a),c=document.getElementById("chars_left");null!==b&&(b.onkeyup=()=>ZeichenUebrig(b,c),ZeichenUebrig(b,c))}setupCharsLeft("beschreibung");setupCharsLeft("notizblock");setupCharsLeft("message");
function setupChefbox(){if(null!==document.getElementById("Chefbox")){reloadOnCountdown=!0;chefboxPollJobs();for(let a of document.getElementById("with_nav_links").getElementsByTagName("a"))a.onclick=()=>BLMNavigation(a.href);document.getElementById("show_blm").onclick=()=>BLMNavigation("./?p=startseite");document.getElementById("close_popup").onclick=()=>BLMEnde();document.getElementById("link_show_help").onclick=()=>BLMNavigation(document.getElementById("link_show_help").href)}}setupChefbox();
function setupMessageDeleteAjax(){let a=document.getElementsByClassName("delete-message");for(let b of a){let c=b.getAttribute("data-id"),d=b.getAttribute("data-token");b.onclick=function(){const e=new XMLHttpRequest;e.open("post","./actions/ajax.php",!0);e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status||404===this.status){let g=document.getElementById("message_"+c);2===g.parentElement.getElementsByTagName("tr").length?window.location.reload():g.remove()}else console.log("could not delete #"+
c)};e.onerror=()=>{console.log("could not delete #"+c)};let f=new FormData;f.set("a","1");f.set("id",c);f.set("token",d);e.send(f);return!1}}}setupMessageDeleteAjax();
